<!--
<? $widepage=1; ?>
<? $title="README"; ?>
<? include($DOCUMENT_ROOT."/projects/mpj/menu.inc.php"); ?>
<? include($DOCUMENT_ROOT."/INCLUDES/layout_top.inc.php"); ?>
-->

<html>
<head>
</head>

<body> 
<h1 align="center"> MPJ Express: An implementation of MPI in Java 
</h1>

<h4 align="center">
Beta Release (0.28)<br />
Aamir Shafi, Bryan Carpenter, and Mark Baker<br />
Last updated: $Date: Tue Jun  3 12:09:02 PKT 2008$<br /><br />
The latest version of this document is available <a href="http://mpj-express.org/docs/readme/README.html"> here </a>
</h4>			  

<a name="toc"></a>
<h2> Table of Contents </h2>

  
<ol> 
  <li> <a href="#introduction"> Introduction </a> </li>
  <li> <a href="#quickstart"> Getting started </a> </li>
  <li> <a href="#compile">  Writing and compiling MPJE programs </a> </li>
  <li> <a href="#rt"> Running MPJE programs with the MPJ Express runtime 
        </a></li>
  <li> <a href="#nrt"> Running MPJE programs without the MPJ Express runtime (manually) 
        </a></li>
  <li> <a href="#testsuite"> The MPJ Express test suite
      </a> </li>
  <li> <a href="#compilesrc"> Compiling MPJ Express source code and test suite
       </a> </li>
  <li> <a href="#testedplatforms"> Tested platforms </a> </li>
  <li> <a href="#javadocs"> Java-docs </a> </li>
  <li> <a href="#contact"> Contact and support </a> </li>
<li> <a href="#misc"> Miscellaneous </a> 
    <ol>
      <li> <a href="#debug"> Turning debugging on and off  </a> </li> 
      <li> <a href="#daemon_consoles">Running daemons in console mode</a> </li> 
      <li> <a href="#dmnvarplats">Running MPJ Express daemons on Solaris, PowerPC Linux, and PowerPC Mac OS X</a> </li> 
      <li> <a href="#psl"> Changing protocol switch limit </a> </li> 
      <li> <a href="#apichanges"> API changes between mpiJava-1.2.x and 
      MPJ Express
      </a> </li>
      <li> <a href="#ack"> Acknowledgements 
      </a> </li>
      <li> <a href="#myridev"> Using the Myrinet deviceM
      </a> </li>
    </ol>
  </li>
  <li> <a href="#issues">Known issues and limitations </a> 
    <ol>   
      <li> <a href="#hanging"> Test cases hang on Solaris and Windows </a> </li>
      <li> <a href="#longboot"> Takes a long time to bootstrap MPJ processes </a> </li>
      <li> <a href="#merge"> Intercomm.Merge(..) -- limited functionality 
           </a> </li>
      <li> <a href="#pack"> Using MPI.PACK datatype -- tweaked  </a> </li>
      <li> <a href="#packbuf"> MPI.PACK with buffered mode -- tweaked </a> </li>
      <li> <a href="#dimscreate"> Cartcomm.Dims_Create(..) -- limited 
                                 functionality 
           </a> </li>
      <li> <a href="#cancel"> Request.Cancel(..) -- not implemented </a> </li>
      <li> <a href="#printing"> Printing long lines (>500 characters) with 
            runtime -- limitation </a> </li>
      <li> <a href="#starter"> Exception "Another mpjrun module is already 
           running on this machine" </a> </li>
      <li> <a href="#pissues"> Permission issues while using MPJ Express
            runtime 
            on Windows </a> </li>
      <li> <a href="#classloading"> Mixing remote loading and local loading may
            end up in ClassNotFoundException for $MPJ_HOME/src/mpi/MPI.java 
            </a>
      </li>
    </ol>
  </li>
</ol>

<ol>

<li>
<a name="introduction"></a>
<h2>Introduction</h2>
</li>

<p>
This software (MPJ Express - MPJE) is a reference implementation of the 
MPI bindings defined for 
the Java language. The current version of this software is following the
<a href="http://www.hpjava.org/reports/mpiJava-spec/mpiJava-spec/mpiJava-spec.html"> mpiJava 1.2 API specification </a>. 
We plan to add support for the <a href="http://www.hpjava.org/papers/MPJ-CPE/cpempi/node6.html"> MPJ API </a> in a subsequent release. It is 
important to note that the difference between these two APIs is in the 
naming schemes 
for classes and methods. The functionality provided to users 
is essentially the same for both APIs.

</p>
<p>

This release contains
the source code and binaries of MPJ Express library, as well as the 
runtime infrastructure. We have developed a test suite that imports 
various test cases from mpiJava; it also has a number of new test cases. This test
suite checks the functionality of almost every MPI function. See 
<a href="#testsuite"> the section on "MPJ Express test suite" </a> for further 
details.
This software 
has been tested on various UNIX and Windows operating systems. See the
<a href="#testedplatforms"> section "Tested Platforms" </a> for a list of tested platforms.

</p>
<p>

There are two fundamental ways of running MPJE applications.
The first, and the recommended way is using the MPJ Express 
runtime infrastructure, 
alternatively the second way involves the 'manual' start-up of 
MPJE processes. 
</p>
<p>
The MPJ Express runtime infrastructure consists of daemons and 
the mpjrun module. The idea is, that the users of MPJ Express first 
start daemons on a number of compute-nodes, which in this document means the
machines that execute MPJE processes. These can also be thought 
as the compute-nodes of a cluster. Once the daemons are running 
on compute-nodes, then the users can use the mpjrun module 
(using mpjrun.sh or mpjrun.bat scripts) on the cluster's head-node,
which contacts the daemons, starting the MPJE 
application, and 
transports output back to the head-node so that users can view the 
progress of their programs during execution. The MPJ Express runtime infrastructure is able to run
the code as JAR or class files. The runtime infrastructure provides 
the notion of local loaders and remote loaders. A user may prefer to use 
local loaders if
the compute-nodes and head-node have a shared file system, and the MPJ Express 
JAR files as well as the user application is available locally on the 
compute-nodes. On the other hand, remote loaders can be used in cases 
where there is no shared file system on the compute-nodes, and the MPJ Express 
JAR files and the user applications have to be fetched from the head-node.

</p>
<p>

The second way, which is referred in this document as 'manual', is to 
run the shell script 'runmpj.sh'
that uses SSH  to execute the code. This script is able to 
run JAR or class files, but it is only possible to use 
this script on UNIX-based operating systems. 
For Windows, running test cases and applications manually means 
starting each MPJE process by using the java command. 

</p>
<p>

The MPJ Express infrastructure does not deal with security in the current 
release. The MPJ Express daemons could be a security concern, as these are 
Java applications listening on a port to execute user-code.  It is therefore 
recommended that the daemons run behind a suitably configured firewall, which
only listens to trusted machines. 
In a normal scenario, these daemons would be running
on the compute-nodes of a cluster, which are not accessible to outside 
world. Alternatively, it is also possible to start MPJE processes 
'manually', which could help avoid runtime daemons. In addition, 
each MPJE process starts at least one server socket, and thus
is assumed to be running on machine with configured firewall. Most MPI 
implementations assume firewalls as protection mechanism from the outside
world.

</p>

<li>
  <a name="quickstart"></a>
  <h2> Getting started </h2>
</li>

<ol>
  <li> 

  The pre-requisite for using MPJ Express is Java 1.5 (stable) or higher. 
  Make sure that you use the stable version because there is a bug in 
  Java 1.5 beta that affects MPJ Express. If you are interested in compiling the 
  source code of MPJ Express, see <a href="#compilesrc"> section "Compiling 
  the MPJ Express source code and test suite </a>
  </li> 

  <br />

  <li>
<a href="http://dsg.port.ac.uk/projects/mpj/soft/download.php"> Download </a> 
MPJ Express 
and unpack it. This should create a folder named "mpj-v&lt;version_number&gt;".
  </li>
  <br />

  <li>Set MPJ_HOME and PATH environmental variables.
    <ul> 
       <li> Linux (assuming MPJ Express is in '/home/aamir/mpj') 
       <pre>       export MPJ_HOME=/home/aamir/mpj
       export PATH=$PATH:$MPJ_HOME/bin </pre>	 
        These lines may be added to ~/.bashrc </li>
       <li> Windows (assuming mpj is in 'c:\mpj') 
         <ul> 
           <li>   
    Right-click My Computer-&gt;Properties-&gt;Advanced tab-&gt;Environment Variables and export the following system variables (user variables are 
    not enough) 
           </li>
           <li>Set the value of variable MPJ_HOME as c:\mpj </li>
           <li>Set the value of variable PATH as c:\mpj\bin </li>
          </ul>
       </li>
     <li> Windows with cygwin (assuming mpj is 'c:\mpj'  
          <ul>
	    <li> The recommended way to is to set variables as in Windows </li>
	    <li> If you want to set variables in cygwin shell </li>
          <pre>
          export MPJ_HOME="c:\\mpj"
          export PATH=$PATH:"$MPJ_HOME\\bin" </pre>
          These lines may be added to ~/.bashrc 
	  </ul>
     </li>  
  </ul>
  </li>
<br />
<li>
  Create a new working directory for MPJE programs. <em>This document 
  assumes that the name of this directory is</em> mpj-user. The location 
  of this directory is not important in the context of execution of
  the code. This directory will hold users MPJE programs, machines
  file, and configuration file (for manual execution)
</li>

<br />
<li>
Start the daemons


   <ul> 
     <li> <code> cd mpj-user </code> </li>
     <li> Write a machines file simply stating a machine name or 
          IP address on 
          each line. Save this file as 'machines' in mpj-user directory. More
          details on the format of machines file can be 
          found <a href="#machines">here</a></li>
   </ul>
   <ul>  
     <li> Installing and starting daemons
       <ul> 
         <li> Linux:  <code>mpjboot machines</code>
	 </li> 
         <li> Windows: on each machine listed in machines file:
           <ul>	
             <li>	  
	       Run $MPJ_HOME/bin/installmpjd-windows.bat 
             </li>
             <li>	  
	       Goto 
Control-Panel-&gt;Administrative Tools-&gt;Services-&gt; MPJ Daemon 
               and start the service. It is important to 
               start the daemon as a user process instead of a SYSTEM process.
               Click <a href="#dwin">here</a> to see how can this be done.
             </li>
           </ul> 
         </li> 
         <li> To test if the daemons have started on compute-node 
           <ul> 
             <li> For Linux Only: Each daemon produces a 
                  MPJ-Daemon&lt;machine_name&gt;.pid  
                  file in $MPJ_HOME/bin directory. </li>
             <li> Each daemon produces a log file named 
                 daemon-&lt;machine_name&gt;.log 
                 in $MPJ_HOME/logs directory.
             </li>
           </ul> 
         </li>
        </ul>
      </li>
   </ul>
</li>
<br />
<li>
<a name="qtestrt"> </a>
Running test cases

      <ul> 
        <li> <code> cd mpj-user </code>
        <li> Linux: <code> mpjrun.sh -np 2 -jar $MPJ_HOME/lib/test.jar 
             </code> </li>
        <li> Windows:  <code> mpjrun.bat -np 2 -jar %MPJ_HOME%/lib/test.jar 
             </code></li> 
        <li> You may <a href="#sample">view sample output</a>. </li>
  </ul>  
 </li>    
<br />
<a name="qhellort"></a>
<li> Running your first MPJE application 

  <ul>
    <li> Write a MPJE program, and save 
         it as World.java. This document is assuming that you 
         have a 'machines' file in mpj-user directory. </li>
    <li> <code> cd mpj-user </code> </li>
    <li> Compile 
      <ul>  
        <li>  
          Linux: <code> javac -cp .:$MPJ_HOME/lib/mpj.jar World.java
                 </code>
        </li>
        <li>
          Windows: <code>
                javac -cp .;%MPJ_HOME%/lib/mpj.jar World.java
                   </code>
         </li>
        </li>
      </ul>   
     </li>
    <li> Execute 
      <ul>
        <li> 
        Linux: <code> mpjrun.sh -np 2 World </code>
        </li>
        <li>
        Windows: <code> mpjrun.bat -np 2 World </code>
        </li>
      </ul>
    </li> 

    <li>
        You may also make a JAR file 'hello.jar' that contains
        World.class (see section <a href="#compile">"Writing and
        compiling MPJE programs"</a> for details) and execute it
      <ul>
        <li> Linux: <code> mpjrun.sh -np 2 -jar hello.jar 
          </code></li>
	<li> Windows: <code> mpjrun.bat -np 2 -jar hello.jar 
          </code></li>
      </ul>
    </li>
 </li>


</ol>

<li>
<a name="compile"></a>
<h2> Writing and compiling MPJE programs </h2>
<ul>

    <li> <code> cd mpj-user </code> </li>

  <li>
   Write your MPJE program.  For example:

   <pre>
   import mpi.*;
   public class World {
     public World() {
     }
     public static void main(String args[]) throws Exception {
       MPI.Init(args);
       int me = MPI.COMM_WORLD.Rank();
       int size = MPI.COMM_WORLD.Size();
       System.out.println("Hi from <"+me+">");
       MPI.Finalize();
     }
   } </pre>

   </li>
   <li>
   Save this program as World.java.
   </li>
   <li>
   Compile the code
       <ul>
         <li>
           Linux: <code>javac -cp .:$MPJ_HOME/lib/mpj.jar World.java
                  </code>
         </li>
         <li>
           Windows: <code>javac -cp .;%MPJ_HOME%/lib/mpj.jar World.java
                    </code>
         </li>
       </ul>
       You may put mpj.jar in your CLASSPATH environment variable.
       If mpj.jar is in the CLASSPATH variable, the -cp switch is not
       required in above commands.
   </li>

       <li>
          Create a JAR file (Optional)
          <ul>
            <li>
          Bundle up the class file into a JAR file. Either copy mpj.jar to the
          current directory or put absolute path of the JAR file in the
          manifest files Class-Path attribute. This document is assuming 
          that you have copied mpj.jar to current directory. Copying mpj.jar
          is only required when you are running JAR files <i> without 
	  </i> runtime and you <i> do not </i> have relative path to 'mpj.jar' in the manifest
          file. 
              <ul>
                 <li>
                   Write the following lines in a file called 'manifest'
                 </li>
                 <pre>
        Manifest-Version: 1.0
        Main-Class: World
        Class-Path: mpj.jar </pre>
                 <li> <code>
                   jar -cfm hello.jar manifest World.class
                 </code> </li>
                 <li>
                   To view the contents of JAR file: 
                   <code> jar -tf hello.jar </code>
                 </li>
              </ul>
            </li>
            <li>  
          One word of caution: While using JAR files, -cp switch, -classpath
          switch, and system CLASSPATH variable is ignored. So its very
          important to specify correctly the dependencies in Class-Path
          attribute of manifest file. This attribute is required only if you are
          running JAR files manually, the runtime will take care of adding
          MPJ Express classes to CLASSPATH itself.
	  </li>
        </ul>
      </li>
</ul>
</li>
<!-- end of Compiling MPJ programs subsection --> 

<li>
<a name="rt"></a>
<h2> Running MPJE programs with MPJ Express runtime </h2> 
<p>

One of the challenging aspects of a Java messaging system is creating a
portable mechanism for bootstrapping MPJE 
processes across various platforms.
If the compute-nodes are running a UNIX-based OS, it is possible to remotely 
execute commands using RSH/SSH, but if the compute-nodes were running 
Windows, these utilities would not be available. 
The MPJ Express runtime provides a 
unified way of starting MPJE processes on 
compute-nodes irrespective of what operating system they may be using. 
The runtime 
system consists of two modules. The 'daemon' module runs on compute-nodes 
and listens for requests to start MPJE processes. The daemon is simply 
a Java application listening on an IP port, which starts a new JVM every time 
there is a request to run a MPJE processes. The 'mpjrun' module 
acts as a client to the daemon module. This module is 
started on, for example, the cluster head-node, 
and will contact daemons and return 
standard output for the user to view. 
</p>

<p>
   With Java, it is possible to run applications using class files, or 
   class files bundled as a JAR file. The MPJ Express runtime allows the 
   execution of 
   MPJE applications both as JAR files and class files. With MPJ Express, 
   the users
   may want to load MPJE JARs and classes either remotely 
   or locally 
   on the compute-nodes. With remote loader, it is possible to load 
   all classes (application and MPJ Express code) from the head-node. This 
   is useful
   in scenarios when there is no shared file system and the code is constantly
   being modified at the head-node. With local loader, it is possible to load
   all classes (application and MPJ Express code) from the compute-node. 
   This might 
   be useful if there is a shared file system. As all classes are loaded 
   locally, this might provide better performance in comparison to 
   remote loader. The default loader used in MPJ Express runtime 
   infrastructure is remote loader. 
   'mpjrun' module provides -jar switch to execute JAR files and no switch 
   is required to execute class files. The users can select local loading
   with the switch -localloader. The -wdir switch can be used to run the code
   in the appropriate directory on the remote node.
   When running JAR files using -localloader,
   the users should put the JAR in the CLASSPATH using -cp switch.
</p>

<p>
MPJ Express uses the <a href="http://sourceforge.net/projects/wrapper/">
Java Service Wrapper Project software</a> to install daemons as a native 
OS service. This essentially means that there is some platform
specific code used in order to achieve this. Currently, MPJ Express is 
distributing 
only Linux and Windows specific native code, but if you are 
interested in running MPJ Express daemons on other platforms like 
AIX, FreeBSD, HP-UX, HP-UX64. IRIX, MacOS, etc., then
you can download the platform specific code from 
<a href="http://sourceforge.net/projects/wrapper/">
Java Service Wrapper Project </a>. Some PATH variables in the
scripts for these platforms will have to be changed. 
Feel free to <a href="#contact"> contact us </a>, if you need 
any help regarding 
this. The rest of this section explains how to install, start, stop, and 
uninstall MPJ Express daemons on Linux and Windows. In addition, it 
also shows how to run your MPJE programs using mpjrun module 
on these platforms.
</p>
  <ul> 
    <li> <code> cd mpj-user </code></li>
    <li> This document assumes mpj-user as the working directory 
         for a user. The name mpj-user itself has no significance.
	 We assume that the user will create a machines file in this
	 directory. In addition, we assume that user's MPJE
	 program (World.class or hello.jar) will be present in this
	 directory when mpjrun script is invoked.
    </li>

<li>
<a name="machines"> </a>
  Write a machines file. This file is used by scripts like 
  mpjboot, mpjhalt, mpjrun.bat and mpjrun.sh to find out which machines to 
  contact. The 'machines' file format is explained in this subsection.
  <ul>
    <li>
        'machines' file is simply a file stating machinename, IP addresses, 
        or aliases of the nodes where you wish to execute MPJE processes. 
        This file is also used by mpjboot and mpjhalt to start and stop 
        daemons on Linux machines. Suppose you want to run a process 
        each on 'machine1' and 'machine2', then your machines file would be 
        as follows
        <pre>
        machine1
        machine2 </pre>
        Note that in the real-world, 'machine1' and 'machine2' would be 
        fully-qualified names, IP addresses, or aliases of your machines.
    </li>
    <li>
      If you are executing mpjrun in directory called mpj-user,
      a command like <code> mpjrun.sh -np 2 World </code> would assume a 
      'machines' file is present in this directory. If you have a list 
      of machines in a file (let us say) 'mymachines.txt' or in another 
      directory, then you can use -machinesfile switch to point mpjrun 
      to machines file. If you want to point mpjrun to mymachines.txt, 
      the exact command would be <code> mpjrun.sh -machinesfile mymachines.txt
      -np 2 World </code>. This is also applicable to mpjrun.bat
    </li>

    <li>
       Multiple processes may be run on a machine.  mpjrun would first see 
       how many processes the user has requested. Let us say the user has 
       requested two processes; then it would try to read the first two 
       entries in the machines file. If there were fewer than two entries
       in machines file, then mpjrun would start two processes on the only 
       entry in machines file. Thus, it is not necessary to put the 
       names of machines twice in 'machines' file. The script should still
       work if machine names have been repeated.
       If you want to run two processes on localhost,
       'machines' file would look like this
        <pre>
        localhost </pre>
    </li>

  </ul>
</li>
    
    <li>
       Installing, starting, stopping, and uninstalling MPJ Express daemons 
      <ul>
        <li> On Linux: 
<!--      
        <li>  
          Warm-up commands (these commands show how to start/stop daemon 
                          on the localhost)
        </li>  
        <ul> 
          <li> <code> mpjdaemon start </code> </li>
          <ul> 
          Starts the daemon on local Linux machine
          </ul>
          <li> <code> mpjdaemon stop </code></li>
          <ul>
          Stop the daemon on local Linux machine
          </ul>
        </ul> 
-->	 
         <ul>
	 <li>  
           Starting daemons on a set of compute-nodes
         </li>
           <ul>
             <li> <code>  
               mpjboot machines 
             </code></li>  
          This should work if $MPJ_HOME/bin has been successfully added 
	  to $PATH variable. This script will SSH into each of the machine 
	  listed in machines file, change directory to $MPJ_HOME/bin,
	  and execute <code> mpjdaemon start </code> command to start 
          the daemon.
          <ul> 
            <li>
	       You will be asked for a password on remote machines if ssh-agent
               has not been configured to allow login without asking for 
               password/pass-phrase. You may get some guidance 
		   <a href=
"http://www.google.com/search?hl=en&lr=&safe=off&c2coff=1&q=setting+up+SSH+without+password&btnG=Search">here</a> about setting up password-less SSH 
               access to compute-nodes. But script will work even if you 
	       do not have password-less SSH access.
            </li>
            <li> 
	       $MPJ_HOME variable should be available on remote nodes. This 
	       may be achieved by putting export statements in ~/.bashrc 
	       file of the remote node.
            </li> 
          </ul> 
         <li>
           Making sure that the daemon is running
         </li>
           <ul> 
             <li>    
               Linux Only: Each daemon produces a 
               MPJ-Daemon&lt;machine_name&gt;.pid file in
	       $MPJ_HOME/bin directory.
             </li>
             <li>
               Each daemon produces a log file named 
               daemon-&lt;machine_name&gt;.log 
                in $MPJ_HOME/logs directory.
	     </li>
           </ul>
         <li> 
           You may optionally run the daemon as a service 
         </li>
           <ul>
              <li> (Only as root)
                Copy mpjdaemon script to /etc/init.d directory and add it to 
	        default runtime level. On Gentoo GNU/Linux, this is, 
		<ul> <li> 
	        <code> rc-update add mpjdaemon default </code>
		</li> </ul>
              </li> 
         <li>
            It is also possible to run the daemon as a non-root user.
         </li>
          </ul>
       </ul>
         <li>
           Shutting down MPJ Express daemons on a set of compute-nodes
         </li>
           <ul> 
             <li><code>
                mpjhalt machines 
             </code></li>
           </ul>
     </ul>  
    </li> 
    <li> 
      On Windows:
    </li>
       <ul>
          <li>
            Installing MPJ Express daemons
          </li>
             <ul> <li>
             Click/run %MPJ_HOME%/bin/installmpjd-windows.bat
             </li> </ul>
           <a name="dwin"></a>
           <li>
            Starting daemons	
           </li>  
           
           <ul><li> 
	   Goto  
	   Control Panel-&gt;Administrative Tools-&gt;Services-&gt;MPJ Daemon
	   and start the service. It is important to start the daemon as 
           a user process (preferably the currently logged in user) 
	   instead of a SYSTEM process. To start the daemons 
           as user process, goto  Control Panel-&gt;Administrative 
           Tools-&gt;-Services,  right-click MPJ Daemon service, click 
           Properties, click "Log On" tab, For the option "Log on as:", 
           select This account and put in  the user name and password of 
           this account, and start the service.

           </li></ul>
	   <ul>
           <li>
             Making sure that the daemon is running
           </li>
             <ul> 
               <li> 
                Linux Only: 
                Each daemon produces a 
                MPJ-Daemon&lt;machine_name&gt;.pid 
                file 
                in $MPJ_HOME/bin directory.
               </li>
               <li> 
	        Each daemon produces a log file named 
                daemon-&lt;machine_name&gt;.log 
                in $MPJ_HOME/logs directory.
               </li>
             </ul> 
	   </ul>  
           <li>
              Stopping daemons
           </li> 
              <ul> <li> 
	    Goto Control Panel-&gt;Administrative Tools-&gt;Services-&gt;MPJ Daemon 
	    and stop the service.
              </li></ul>  
	   <li>
	      Uninstalling daemons 
	   </li>
              <ul> <li> 
	         Click/run %MPJ_HOME%/bin/uninstallmpjd-windows.bat to 
		 uninstall the daemon. This will have to be repeated
		 manually for each machine running the daemon.
              </li></ul>  
        </ul>
	</ul>
        </li>
          <li> Configuring MPJ Express daemons using the configuration file 
	       (Optional) </li>
          <ul>
            <li> There is a configuration file $MPJ_HOME/conf/wrapper.conf 
                 that can be used to configure MPJ Express daemons. It is 
                 important to note that 
	         any options specified in this file would only affect MPJ Express
                 daemons,
	         not user applications. The JVM for MPJ Express daemons and 
                 user applications
	         are different. For providing options to user processes,
        	 JVM arguments or application arguments should be specified to 
        	 mpjrun.sh or mpjrun.bat script. 
		 For a complete list of options that 
        	 can be used in wrapper.conf to configure MPJ Express 
                 daemons, have a look
  <a href="http://wrapper.tanukisoftware.org/doc/english/properties.html">
         here </a> 
            </li> 
        </ul>
   <li>
     Running your MPJE program. 
   </li>
        </li>
       <ul>   
        <li>
          Running class files 
        </li>
          <ul>
           <li>
             Linux: <code> mpjrun.sh -np 2 World </code>
           </li>
           <li>
             Windows: <code> mpjrun.bat -np 2 World </code>
           </li>
           </ul>
         <li>
           Running JAR files
         </li>
              <ul> 
                <li>
                   Linux:  <code> mpjrun.sh -np 2 -jar hello.jar  </code>
                </li>
                <li>
                   Windows: <code> mpjrun.bat -np 2 -jar hello.jar </code>
                </li>
            </ul>

               <li>
                  Passing arguments to the JVM running MPJE program
               </li>
                 <ul>
          <li> 
       mpjrun.bat or mpjrun.sh script accepts all JVM arguments and would 
       forward these to the JVMs running MPJE processes on 
       compute-nodes. For instance, if the users would like to 
       pass -Xms512M and 
       -Djava.library.path=/tmp as two arguments to World program, the 
       exact command would be 
       <ul>
       <li> For Linux:
       <code> mpjrun.sh -np 2 -Xms512M -Djava.library.path=/tmp World</code> 
       </li>
       <li> For Windows: 
       <code> mpjrun.bat -np 2 -Xms512M -Djava.library.path=c:/tmp World</code> 
       </li> </ul>
          </li>
  </ul>

<li>
   Passing arguments to MPJE application.
</li>
  <ul>
   <li>
       Any arguments after "-jar &lt;jarname&gt;" or "classname" is treated as 
       application argument by mpjrun.sh and mpjrun.bat scripts.
       MPI.Init(String[] args) 
       returns a String array that contains user 
       specified arguments. If the user has specified two arguments:
       apparg1 and apparg2, then MPI.Init(..) returns an 
       array which has length 2, apparg1 at index 0, and apparg2 at index 1.
   </li>
  </ul> 
       </ul>
       
</ul>
</li>

<!-- end of Running MPJ programs with runtime -->
<li>
<a name="nrt"></a>
<h2> Running MPJE programs without MPJ Express runtime (manually) </h2> 
</li>
We do <em>not</em> recommand starting programs manually as normal procedure.
This section documents the procedure for manual start-up, mainly to
allow developers the flexibility to create their own initiation
mechanisms for MPJE programs.  The runmpj.sh script can be considered
one example of such a mechanism.
<ul>
  <li>
   <code> cd mpj-user </code>
  </li>
  <li> This document is assuming mpj-user as the working directory 
       for users. The name mpj-user itself has no significance.
       We assume that users will create configuration file in this
       directory. In addition, we assume that the user's MPJE
       program (World.class or hello.jar) will be present in this
       directory at the time of execution of MPJE processes
   </li>
   
<a name="config"></a>     
   <li>
   Write a configuration file called 'mpj.conf' as follows.

  <ul>
     <li> A typical configuration file that would be used to start two 
          MPJE processes is as follows. Note the names 'machine1' and 
          'machine2' would be replaced by aliases/fully-qualified-names/
          IP-addresses of the machines where you want to start 
          MPJE processes
     <pre>
     # Number of processes
     2
     # Protocol switch limit
     131072
     # Entry in the form of machinename@port@rank
     machine1@20000@0
     machine2@20000@1  </pre>
     </li>
     <li>
       The lines starting with '#' are comments. The first entry which is 
       a number ('2' above) represents total number of processes. The second
       entry, which is again a number ('131072' above) is the protocol 
       switch limit. At this message size, MPJ Express changes its 
       communication 
       protocol from eager-send to rendezvous. There are a couple of entries,
       one for each MPJE process, each in the form of 
       machinename(OR)IP@PORT_NUMBER@RANK. Using this, the users of 
       MPJ Express 
       can control where each MPJE process runs, what server port it uses, 
       and what should be the rank of each process. The rank specified here
       should exactly match the rank argument provided while manually 
       starting MPJE processes (using java command). When the users 
       decide to run their code using mpjrun, this file is generated 
       programmatically.
     </li>
     <li> Sample configuration files can be found in $MPJ_HOME/conf directory.
          If you wish to start MPJ processes on localhost, see
          $MPJ_HOME/conf/local2.conf file.
     </li>
     <li>
         Each MPJ process uses two ports. Thus, do not use consecutive ports
         if you are trying to execute multiple MPJE processes on same node. A sample
         file for running two MPJE processes on same machine  would be 
    <pre>
     # Number of processes
     2
     # Protocol switch limit
     131072
     # Entry in the form of machinename@port@rank
     localhost@20000@0
     localhost@20002@1 </pre>
     </li>
       
  </ul>
</li>

   <li>
     Running your MPJE program.
   </li>
        </li>
       <ul>   
        <li>
           The script runmpj.sh requires password-less SSH access to machines
           listed in the configuration file. This script will not work if 
           your machines are not setup for this. You may get some guidance
 <a href=
"http://www.google.com/search?hl=en&lr=&safe=off&c2coff=1&q=setting+up+SSH+without+password&btnG=Search"> here </a> 
	   regarding setting up SSH so that 
           no password/passphrase is required at login.
          This is the only script in this 
          software which 
          requires password-less access. An alternative to using runmpj.sh 
          is the manual start-up (using java command directly -- see directions
          below)
        </li>  

       <li>
         Running class files
       </li>
         <ul>
           <li>
             Linux: <code> runmpj.sh mpj.conf World  </code> 
             <ul> <li>
              Alternatively, 
             the directions for Windows should work also.
             </li> </ul>
           </li>
           <li> Windows and Linux: </li>
             <ul>
               <li>
                For all the machines listed in mpj.conf, login to each Windows
                or Linux   
                machine, change directory to %MPJ_HOME% (Windows) or 
                $MPJ_HOME (Linux)
                , and type,
               </li>
                 <ul>
                   <li>
               Linux: <code>
         java -cp .:$MPJ_HOME/lib/mpj.jar World &lt;rank&gt; mpj.conf niodev
                      </code>
                   </li>
                   <li>
                                            Windows: <code>
         java -cp .;%MPJ_HOME%/lib/mpj.jar World &lt;rank&gt; mpj.conf niodev
                         </code>
                   </li>
                   <li> The &lt;rank&gt; argument should be 0 for process 0 and
                         1 for process 1. This should match to what has been
                         written in configuration file (mpj.conf). Check the
                         entry format in the configuration file to be sure
                         of the rank.
                   </li>
                 </ul>
             </ul>
         </ul>
        <li>
          Running JAR files
        </li>
          <ul>
             <li>
               Linux: <code> runmpj.sh mpj.conf hello.jar </code> 
             </li>
                 <ul>
                   <li>
                     Alternatively, the directions for Windows should work
                   </li>
                 </ul>

              <li>
                Windows and Linux:
              </li>

                  <ul>
               <li>
                For all the machines listed in mpj.conf, login to each Windows
                or Linux
                machine, and type,
               </li>
                 <ul>
                   <li>
               Linux: <code>
                       java -jar hello.jar &lt;rank&gt; mpj.conf niodev
                      </code>
                   </li>
                   <li>
                                            Windows: <code>
                       java -jar hello.jar &lt;rank&gt; mpj.conf niodev
                         </code>
                   </li>
                   <li> The &lt;rank&gt; argument should be 0 for process 0 and
                         1 for process 1. This should match to what has been
                         written in configuration file (mpj.conf). Check the
                         entry format in the configuration file to be sure
                         of the rank.
                   </li>
                 </ul>
             </ul>

          </ul>

<li>
Passing arguments to the JVM running MPJE program
</li>
  <ul>
   <li> 
       Edit $MPJ_HOME/bin/runmpj.sh shell script to pass the arguments 
       to the JVM.
   </li>
  </ul> 

<li>
   Passing arguments to MPJE application.
</li>
  <ul>
   <li>
       Edit $MPJ_HOME/bin/runmpj.sh shell script to pass the arguments 
       to the application. MPI.Init(String[] args) 
       returns a String array that contains user 
       specified arguments. If the user has specified two arguments:
       apparg1 and apparg2, then MPI.Init(..) returns an 
       array which has length 2, apparg1 at index 0, and apparg2 at index 1.
   </li>
  </ul>
  
     </ul>
     

      </ul>
</ul>

<!-- end of Running MPJ programs without runtime -->

<br />
<a name="testsuite">
<li> <h2>
  MPJ Express test suite </h2>
</li>
</a>

<p>
MPJ Express contains a comprehensive test suite to test the 
functionality of almost
every MPI function. This test suite consists mainly of mpiJava test cases, 
MPJ JGF benchmarks, and MPJ microbenchmarks. 
The mpiJava test cases were originally developed by IBM and later translated to
Java. As this software follows the API of mpiJava, 
these test cases can be used with a little modification.
MPJ JGF benchmarks are developed and maintained by 
<a href="http://www.epcc.ed.ac.uk/"> EPCC at the University of Edingburgh </a>.
MPJ Express is redistributing these benchmarks as part of its test suite. 
The original copyrights and license remain intact as can be seen 
in source-files of these benchmarks in $MPJ_HOME/test/jgf_mpj_benchmarks. 
Further details about these benchmarks
can be seen <a href="http://www.epcc.ed.ac.uk/javagrande/mpj.html">here</a>.
MPJ Express also redistributes micro-benchmarks developed by 
<a href="http://www.des.udc.es/~gltaboada/"> Guillermo Taboada </a>. 
Further details about these benchmarks can be obtained 
<a href="http://www.des.udc.es/~gltaboada/micro-bench/index.html"> here </a>
</p>
<p>
The suite is located in $MPJ_HOME/tests directory. The test cases have 
been changed from their original versions, in order to automate testing. 
TestSuite.java is the main class that calls each of the test case present 
in this directory. The build.xml file present in test directory, compiles
all test cases, and places test.jar into the lib directory. 
By default, JGF MPJ benchmarks and MPJ micro-benchmarks are disabled. 
Edit $MPJ_HOME/test/TestSuite.java to uncomment these tests 
and execute them. Note, after changing TestSuite.java, you will have
to recompile the testsuite by executing 'ant' in test
directory.
</p>

<ul>
    <li> <code> cd mpj-user </code>
    </li>
    <li> This document is assuming that mpj-user is the working 
    directory for MPJ Express users and the name mpj-user itself 
    has no significance. For this section, mpj-user should
    contain 'mpj.conf', which is the configuration file required if you 
    are running the code without runtime(manually). If you are using the
    runtime, then this directory should contain 'machines' file, which contains
    a list of machines where MPJ Express daemons are running.
    <li>
      Running test cases with MPJ Express runtime
    </li>
      <ul>
        <li> Write a machines file. More details on machines file can 
	be found in the <a href="#machines">the section "Running MPJE 
	programs with the MPJ Express runtime" </a> </li>
	
        <li>
          Linux: <code> mpjrun.sh -np 2 -jar $MPJ_HOME/lib/test.jar </code>
        </li>
         <li>
          Windows: <code> mpjrun.bat -np 2 -jar %MPJ_HOME%/lib/test.jar </code>
         </li>
       </ul>

    <li> Running test cases without the runtime (manually) </li>  
      <ul>
     <li> Write a configuration file called 'mpj.conf'. Further details about 
         writing configuration file and its format can be found in 
	<a href="#config">the section "Running MPJE programs without 
	the runtime (manually)" </a> </li>
    </li>
    <li>
      Start the tests
    </li>

      <ul>

      <li> Linux: 
          <code> 
              runmpj.sh mpj.conf $MPJ_HOME/lib/test.jar 
          </code>
      </li>
        <ul>
          <li>
            'runmpj.sh' requires password-less SSH access to machines in the 
            configuration file. To see how this can be done, look
                   <a href=
"http://www.google.com/search?hl=en&lr=&safe=off&c2coff=1&q=setting+up+SSH+without+password&btnG=Search"> here </a>. 
          </li>
          <li>
            Alternatively, the directions for Windows should work. 
          </li>
        </ul>
 
      <li> Windows and Linux: </li>
                  <ul>
               <li>
                For all the machines listed in mpj.conf, login to each Windows
                or Linux
                machine, type,
               </li>
                 <ul>
                   <li>
               Linux: <code>
                       java -jar $MPJ_HOME/lib/test.jar &lt;rank&gt; mpj.conf niodev
                      </code>
                   </li>
                   <li>
                                            Windows: <code>
                       java -jar %MPJ_HOME%/lib/test.jar &lt;rank&gt; mpj.conf niodev
                         </code>
                   </li>
                   <li> The &lt;rank&gt; argument should be 0 for process 0 and
                         1 for process 1. This should match to what has been
                         written in configuration file (mpj.conf). Check the
                         entry format in the configuration file to be sure
                         of the rank.
                   </li>
                 </ul>
             </ul>
      </ul>
    </ul>  
       
  <li>   
    <a name="sample"/></a>
    You may view the sample output of test cases at 
    http://dsg.port.ac.uk/projects/mpj/docs/res/t-&lt;VERSION&gt;.txt 
    For version 0.26, this would translate to: 
    http://dsg.port.ac.uk/projects/mpj/docs/res/t-0.26.txt 
    Click here to 
    <a href="http://dsg.port.ac.uk/projects/mpj/docs/res/t-0.26.txt"> 
    view it </a>.
  </li>
</ul>
<!-- end of MPJ Express test-suite section -->

<br />
<a name="compilesrc">
<li> <h2> Compiling MPJ Express source code and test suite </h2> </li>
 <ul> 
   <li> Pre-requisites (For compiling and running the code) </li>
     <ul> 
       <li> Java 1.5 (stable) or higher </li>
         <ul>
           <li> Verify this by executing,  </li>
             <ul> 
                <li> 'java -version' (should be stable 1.5 
                            or higher) </li>
                  <ul> 
                    <li> MPJ Express has been developed and tested using
                         java 1.5. But it is possible to compile the
                         code with '-source release' and '-target release'.
                    </li>
                  </ul>

                <li> 'javac' (should see usage information) </li>
             </ul>
         </ul>
       <li> Apache ant 1.6.2 or higher </li>
         <ul>
           <li> Verify this by executing 'ant'. This command should
                display usage information, </li>
         </ul>
       <li> Perl (Optional) </li>
          <ul>
            <li>
       MPJ Express needs Perl for compiling source code because some of the Java
       code is generated from Perl templates. The build file will generate
       Java files from Perl templates if it detects perl on the machine.
       It is a good idea to install Perl if you want to do some development
       with MPJ Express.
            </li>
            <li> Perl for Windows can be downloaded
<a href="http://www.activestate.com/Products/Download/Download.plex?id=ActivePerl"> here </a>
            </li>

            <li> build.xml points to the Perl executable.  You may
               need to edit the property perl.executable to reference the
               Perl executable.
            </li>

          </ul>
     </ul>
    <li> Compiling MPJ Express source code </li>
  <ul>
    <li> Being in $MPJ_HOME directory, execute <code>ant</code></li>
    <ul>
      <li> Produces mpj.jar, daemon.jar, and starter.jar in
           lib directory. </li>
    </ul>
  </ul>

  <li> Compiling MPJ Express test-code </li>
    <ul>
      <li><code>cd test</code></li>
      <li><code>ant</code></li>
        <ul>
          <li> This produces test.jar in lib directory. </li>
        </ul>
    </ul>
   </ul>

</a>
<!-- end of compiling source-code and testsuite section --> 
<br />
<li>
<a name="testedplatforms"></a>
<h2> Tested Platforms </h2>
</li>

<ul>
<li>
Gentoo GNU/Linux (kernel 2.6.10)
</li>
<li>
Debian GNU/Linux 'Sarge' (kernel 2.4.30)
</li>
<li>
SuSE 9.0 GNU/Linux (kernel 2.4.21)
</li>
<li>
Red Hat Fedora Core 4 GNU/Linux (kernel 2.6.12)
</li>
<li>
Red Hat Linux 7.3  GNU/Linux (kernel 2.4.19-openmosix)
</li>
<li>
Windows XP (Service Pack 2)
</li>
<li>
Windows XP with cygwin (Service Pack 2)
</li>
</ul>

<br />
<li>
<a name="javadocs"></a>
<h2> Java-docs </h2>
</li>

<p>
Java-docs can be seen in $MPJ_HOME/doc/javadocs
</p>

<li>
<a name="contact"></a>
<h2> Contact and support </h2>
</li>

<ul>

<li>
  To support users of this software, we have setup a 
  <a href="http://tools.iso.port.ac.uk/mailman/listinfo/mpj-user"> 
  mailing list </a>. The users 
  are encouraged to subscribe and share their experiences of using 
  MPJ Express. 
  In case of any problems, please make sure that you have read the 
  documentation (including this README). If your 
  question(s) still remain unanswered, feel free to post to the list. 
  Some useful pointers for the mailing list are following: 
 
</li>
  <ul> 
    <li>
     <a href="http://tools.iso.port.ac.uk/mailman/listinfo/mpj-user"> 
      Subscribe/Unsubscribe the mailing list </a> 
    </li>
    <li>
     <a href="http://tools.iso.port.ac.uk/pipermail/mpj-user/"> 
      Mailing list archives </a>
    </li>
  </ul>

<li>
    Alternatively, the users can contact us directly by email.
</li>
  <ul>
    <li>
       <a href="mailto:aamir.shafi@port.ac.uk"> Aamir Shafi </a>
    </li>
    <li>
       <a href="mailto:dbc@ecs.soton.ac.uk"> Bryan Carpenter </a>
    </li>
    <li>
       <a href="http://dsg.port.ac.uk/~mab"> Mark Baker </a>
    </li>
  </ul>

</ul>

<br />
<li>
<a name="misc"></a>
<h2> Miscellaneous </h2>
</li>

<ol>
<a name="debug">
<li>
  Turning debugging on and off 
</li>
</a>
   <ul>
     <li>
     MPJ Express uses log4j for logging purposes. 
     By default, the logging is turned 
     off. To turn logging on/off, the users can edit certain Java files to turn 
     it off/on. This can be achieved in two ways.
     </li> 
      <ul>
        <li>
          More efficient way,
        </li>
          <ul>
            <li>
              Edit src/mpi/MPI.java and change value of 
              static boolean DEBUG flag to true
            </li>
            <li>
              Recompile the code
            </li>
            <li>
              This approach is preferred for benchmarking MPJ 
            </li>
          </ul> 
        <li>
	  Less efficient way,
        </li>
          <ul> 
            <li>   
              Edit $MPJ_HOME/src/mpi/MPI.java, and uncomment this line 
	      to turn logging on. 
	      <code> //rep.setThreshold((Level) Level.OFF ) ; </code>
	      By calling 
	      <a href="http://logging.apache.org/log4j/docs/api/org/apache/log4j/spi/LoggerRepository.html#setThreshold(org.apache.log4j.Level)">setThreshold(..) </a> method of 
	      LoggerRepository associated with rootLogger, the threshold level
	      for logging can be set. If this level is Level.OFF
	      then all logging is dropped by the rootLogger. By default, 
	      the level is set to Level.ALL
            </li>
            <li>
              Recompile the code
            </li>
          </ul> 

       </ul>
      <li>
     The runtime infrastructure also uses log4j. By default, the logging 
     for the runtime is turned on. To turn it off, the users can edit 
     src/runtime/starter/MPJRun.java and src/runtime/daemon/MPJDaemon.java 
     and change the value of DEBUG flag to false.
      </li> 

      <li> MPJ Express runtime daemons can be debugged as follows: 
        <ul>
	  <li> Edit $MPJ_HOME/conf/wrapper.conf file. 
	  </li>
	  <li> Change the value of wrapper.logfile.loglevel from "NONE" to 
	       "DEBUG". 
	  </li> 
	  <li> Now the output of mpjboot, mpjhalt, and other daemon activities
	       can be seen in $MPJ_HOME/logs/wrapper.log file. This information
	       is pretty useful for diagnosing and fixing daemons errors.
	  </li>
	</ul>
      </li> 
      
   </ul>

  


<br />
<a name="psl">  </a>			      
  <li> Changing protocol switch limit </li>
  <ul>
    <li> 
      MPJ Express uses two communication protocols: 
      the first is 'eager-send', which 
      is used for transferring small messages. The other protocol is 
      rendezvous protocol useful for transferring large messages. The default
      protocol switch limit is 128 KBytes. This can be changed prior to
      execution in following ways depending on whether you are running 
      processes manually or using the runtime.
      <ul>
        <li>
	  Running MPJE applications manually (without using 
          runtime): The users may edit 
	  configuration file (for e.g. $MPJ_HOME/conf/mpj2.conf) to change
	  protocol switch limit. Look at the comments in this configuration 
	  file. The second entry, which should be 131072 if you have not 
	  changed it, represents protocol switch limit
	</li>
	<li>
	  Running MPJE applications with the runtime: Use -psl &lt;val&gt; switch to change 
	  the protocol switch limit
	</li>
      </ul>
    </li> 
  </ul>

<br />
<a name="daemon_consoles"></a>
<li>
   For debugging purposes, sometimes it is useful to run the daemons in 
   console mode. This can be achieved in the following way: 

   <ol>
      <li> 
        <code> cd $MPJ_HOME/bin </code>
      </li>

      <li> On UNIX systems, execute 
      <code> ./mpjdaemon_linux_x86_32 console </code>. Here we are starting 
       the daemon on a 32 bit x86 processor. Choose the appropriate script 
       for your machine. 
      </li>  	

      <li> On Windows, execute 
           <code>
	        cd %MPJ_HOME%/bin ; 
	        wrapper.exe -c ../conf/wrapper.conf
	   </code> 
      </li>
      </li>
      
    </ol>  	
</li>

<br />
<a name="dmnvarplats"></a>
<li> 
   With default settings attempting to start MPJ Express daemons on UltraSPARC 
   Solaris, PowerPC (PPC) Linux, or PPC Mac OS X would result in an error 
   like this: 
   <pre> 
     mpjboot machines 
     Starting mpjd... 
     ./mpjdaemon_linux_x86_32: line 1: ./daemon_linux_x86_32: cannot execute binary file 
   </pre>

   The reason is that by default x86 based code is called, which naturally does
   not work on PPCs and UltraSPARCs. 

   We are currently in the process of writing smart scripts that call 
   the appropriate libraries based on the processor architecture and 
   operating system. In the meantime, this problem can be fixed in the 
   following way: 

   <ul> 
     <li> Solaris
	  <pre> 
	  a. Edit $MPJ_HOME/bin/mpjboot and $MPJ_HOME/bin/mpjhalt
	  b. Comment the line ssh $host "cd $MPJ_HOME/bin;./mpjdaemon_linux_x86_32 start;"
	  c. Uncomment the line #ssh $host "cd $MPJ_HOME/bin;./mpjdaemon_solaris_sparc_64 start;"
	  d. cd $MPJ_HOME/lib
	  e. cp libwrapper.so_solaris_sparc_64 libwrapper.so
	  </pre>
     </li>
     <li> PPC64 Linux
	  <pre> 
	  a. Edit $MPJ_HOME/bin/mpjboot and $MPJ_HOME/bin/mpjhalt
	  b. Comment the line ssh $host "cd $MPJ_HOME/bin;./mpjdaemon_linux_x86_32 start;"
	  c. Uncomment the line #ssh $host "cd $MPJ_HOME/bin;./mpjdaemon_linux_ppc_64 start;" 
	  d. cd $MPJ_HOME/lib
	  e. cp libwrapper.so_linux_ppc_64 libwrapper.so
	  </pre>
     </li>
     <li> PPC32 Mac OS X
	  <pre> 
	  a. Edit $MPJ_HOME/bin/mpjboot and $MPJ_HOME/bin/mpjhalt
	  b. Comment the line ssh $host "cd $MPJ_HOME/bin;./mpjdaemon_linux_x86_32 start;"
	  c. Uncomment the line #ssh $host "cd $MPJ_HOME/bin;./mpjdaemon_macosx_ppc_32 start;"
	  d. cd $MPJ_HOME/lib
	  e. cp libwrapper.jnilib_macosx_ppc_32 libwrapper.jnilib
	  </pre>
     </li>
   </ul> 
</li>

<br />
<a name="apichanges"></a>
<li>
   To see API differences between mpiJava-1.2.x, and MPJ Express, read 
   $MPJ_HOME/doc/APICHANGES.txt
</li>


<br />
<a name="ack"></a>
<li>

We would like to thank: </li>

<ul>
 <li>
<a href="http://www.ccs.ornl.gov/~hongo/main/"> Hong Ong </a> for his 
input to the initial design of niodev in particular and the software 
in general,</li>
<li>
<a href="http://www.des.udc.es/~gltaboada/"> Guillermo Taboada </a> for 
alpha testing of the software
</li>
<li>
<a href="http://hpc.niit.edu.pk/~mohsan"> Mohsan Jameel </a> for testing of the software 
</li>
</ul>

<br />
<a name="myridev"></a>
<li> Using the Myrinet device </li>

<ul>


<li> Export the MX_HOME variable. Assuming the Myrinet eXpress (MX) dirver
     is in /opt/mx, the variable is exported as follows:

          <pre>
	              export MX_HOME=/opt/mx
          </pre>

</li>

<li> Edit build.xml (in $MPJ_HOME) and change the following line:

</li>

</li>

  <pre>
    &lt;target name=&quot;all&quot; depends=&quot;compile,jars,java-docs,clean&quot;
  </pre>

to:

  <pre>
    &lt;target name=&quot;all&quot; depends=&quot;mxlib,compile,jars,java-docs,clean&quot;
  </pre>

Note that we have added mxlib in the value of &quot;depends&quot; attribute.

<li> Being in $MPJ_HOME directory, run the command &quot;ant&quot;. You will see some funny warning messages from gcc but things will work. The native libraries *.so and JAR files are produced in $MPJ_HOME/lib directory.

</li>

<li>Now write machines file. Basically for this, run mx_info (assuming $MX_HOME/bin is in the $PATH variable) you'll get something like this:

<pre>
-bash-3.00$ mx_info
MX Version: 1.1.7rc3cvs1_1_fixes
MX Build: @indus1:/opt/mx2g-1.1.7rc3 Thu May 31 11:03:00 PKT 2007
2 Myrinet boards installed.
The MX driver is configured to support up to 4 instances and 1024 nodes.

[ .. ]

ROUTE COUNT
INDEX MAC ADDRESS HOST NAME P0
----- ----------- --------- ---
0) 00:60:dd:47:ad:7c indus1:0 1,1
1) 00:60:dd:47:ad:68 indus4:0 1,1

[ .. ]

</pre>

This means we have two machines &quot;indus1&quot; and &quot;indus4&quot;
connected to each other via Myrinet and they are using NIC-0.

So now for this configuration, my machines file would look like this:

<pre>
indus1
indus4
</pre>

<li> The device can be used by executing:

<pre>
mpjrun.sh -np 2 -dev mxdev -Djava.library.path=$MPJ_HOME/lib HelloWorld
</pre>

This command is assuming the Myrinet NICs with id 0 are used, this may be changed by using the mpjrun switch called &quot;-mxboardnum&quot;

</li>

</ul>

</ol>
<!-- end of ack subsection --> 

<br />
<li>
<a name="issues"></a>
<h2> Known issues and limitations </h2>
</li>

<ul>
<a name="hanging"> </a>
<li>
  <p>
  There is a known (upto some extent) problem on Windows and Solaris that 
  results in hanging MPJ processes. Normally this will be observed when 
  MPJ test-cases will hang, as result, not completing or throwing any 
  error message. 
  </p>

  <p> We partially understand the problem but if some user encounters 
  this problem, we would request some more debugging information. The 
  required information can be obtained as follows. 
  Edit $MPJ_HOME/src/xdev/niodev/NIODevice.java and goto line 3673 
  and uncomment the line "ioe1.printStackTrace() ;". The line 3673 
  is in the MPJ Express release 0.27 and it might change in 
  the future. The general code snippet is like this: 
  <pre> 

      catch (Exception ioe1) {
        if(mpi.MPI.DEBUG && logger.isDebugEnabled() )  {
          logger.debug(" error in selector thread " + ioe1.getMessage());
        }
        //ioe1.printStackTrace() ;
      } //end catch(Exception e) ...

      if(mpi.MPI.DEBUG && logger.isDebugEnabled()) {
        logger.debug(" last statement in selector thread");
      }

    } //end run()

  }; //end selectorThread which is an inner class

  </pre> 
   </p> 	

   <p> As a result now, when test-cases are executed again, users will
       see stacks periodically. Most of these are related to socket 
       closed exceptions that are normal. If the code hangs now,  
       the latest stack trace that is not about socket being closed 
       is perhaps the reason of this hanging behaviour. We would request
       the users to kindly email us the output so that we can fix the 
       problem. A stack trace that leaves MPJ Express hanging on Solaris 
       is as follows: 

       <pre>
         java.nio.channels.CancelledKeyException
           at sun.nio.ch.SelectionKeyImpl.ensureValid(SelectionKeyImpl.java:55)
           at sun.nio.ch.SelectionKeyImpl.readyOps(SelectionKeyImpl.java:69)
           at java.nio.channels.SelectionKey.isAcceptable(SelectionKey.java:342)
           at xdev.niodev.NIODevice$2.run(NIODevice.java:3330)
           at java.lang.Thread.run(Thread.java:595)
       </pre>
       
    </p>
</li>

<br />
<a name="longboot"> </a>
<li>

  <p> Some users have noticed that it takes a long time to bootstrap 
      MPJ Express processes. For example,
  </p> 

<pre>
user@machine:~/mpj-user> mpjrun.sh -np 6 -jar $MPJ_HOME/lib/test.jar
16:15:43.400 EVENT  Starting Jetty/4.2.23
16:15:43.415 EVENT  Started HttpContext[/]
16:15:43.419 EVENT  Started SocketListener on 0.0.0.0:15000
16:15:43.419 EVENT  Started org.mortbay.http.HttpServer@23ac23ac
16:15:43.420 EVENT  Starting Jetty/4.2.23
16:15:43.420 EVENT  Started HttpContext[/]
16:15:43.421 EVENT  Started SocketListener on 0.0.0.0:15001
16:15:43.421 EVENT  Started org.mortbay.http.HttpServer@50265026

[ pause for a minute or two ]

Starting process <0> on <m1>
Starting process <1> on <m1>

[ pause for a minute or two ]

Starting process <2> on <m2>
Starting process <3> on <m3>

[ pause for a minute or two ]

Starting process <4> on <m3>
Starting process <5> on <m3>

[ job starts ]
</pre> 

<p> Thanks to Andy Botting who is one of the users that identified this 
    problem. This problem is perhaps related to name resolution and we are
    currently working to fix it. 
</p> 
  
</li>

<br />
<a name="merge"> </a>
<li>
   The merge operation is implemented with limited functionality. The processes 
   in local-group and remote-group *have* to specify 'high' 
   argument. Also, the value specified by local-group processes should be 
   opposite to remote-group processes. 
</li>

<br />
<a name="merge"> </a>
<li>
   The merge operation is implemented with limited functionality. The processes 
   in local-group and remote-group *have* to specify 'high' 
   argument. Also, the value specified by local-group processes should be 
   opposite to remote-group processes. 
</li>

<br />
<a name="pack"> </a>
<li>	    
   Any message sent with MPI.PACK can only be received by using MPI.PACK
   as the datatype. Later, MPI.Unpack(..) can be used to unpack different 
   datatypes.
</li>

<br />
<a name="packbuf"> </a>
<li>
   Using 'buffered' mode of send with MPI.PACK as the datatype really does
   not use the buffer specified by MPI.Buffer_attach(..) method.
</li>

<br />
<a name="dimscreate"> </a>
<li>
   Cartcomm.Dims_Create(..) is implemented with limited functionality. 
   According to the MPI specifications, non-zero elements of 'dims' 
   array argument will not be modified by this method. In this 
   release of MPJE, all elements of 'dims' array are modified without 
   taking into account if they are zero or non-zero.
</li>

<br />
<a name="cancel"> </a>
<li>
   Request.Cancel(..) is not implemented in this release. 
</li>


<br />
<a name="printing"> </a>
<li>
   MPJ applications should not print more than 500 characters in one line. Some 
   users may use System.out.print(..) to print more than 500 characters.
   This is not a serious problem, because printing 100 characters 5 times 
   with System.out.println(..) will have the same effect as printing 
   500 characters with one System.out.print(..)
</li>

<br />
<a name="starter"> </a>
<li>
   Some users may see this exception while trying to start the mpjrun module.
   This can happen when the users are trying to run mpjrun.bat script. The
   reason for this error is that the mpjrun module cannot contact the daemon
   and it tries to clean up the resources it has. In doing so, it tries to 
   delete a file named 'mpjdev.conf' using File.deleteOnExit() method. 
   This method appears not to work on Windows possibly because of permission
   issues.
   <pre>
      Exception in thread "main" java.lang.RuntimeException: Another mpjrun
      module is already running on this machine
        at runtime.starter.MPJRun.<init>(MPJRun.java:135)
        at runtime.starter.MPJRun.main(MPJRun.java:925)
   </pre>
   This issue can be resolved by deleting mpjdev.conf file. This file would 
   be present in the directory, where your main class or JAR file is present.
   So for example, if the users are trying to run "-jar ../lib/test.jar", 
   then this file would be present in ../lib directory.

</li>


<br />
<a name="pissues"></a>
<li>   
  Permission issues while using MPJ Express runtime with Windows
</li>

<ul>

<li>
     Problem: The users may run into issues with starting daemons on Windows. 
     The reason is that when MPJE processes are started manually, the owner
     is the user who started them. Thus the log files produced by these
     processes are owned by the user. On the other hand, the daemon is installed
     as a SYSTEM service. Thus, while starting the daemon, it may not be able
     to write to the log file, because logs directory is owned by user,
     whereas for daemon to be able to write to this directory, it has to be 
     globally accessible. Even when the daemon is started, MPJE
     processes may not be able to write process log files because these
     log files are owned by the user, whereas now they are required to be 
     globally accessible as MPJE processes started by the daemon are also 
     SYSTEM processes. So the problem is caused if the users switch from 
     running their code manually to the runtime, or possibly vice-versa.
</li>

<li>
   Solution: 
</li>
    <ul>
     <li> 
      This can be avoided by starting MPJ Express daemons as user 
      process instead 
      of SYSTEM process. To restart the daemons as user process, goto
         "Control Panel-&gt;Administrative Tools-&gt;-Services", 
      right-click MPJ Daemon service, click Properties, click "Log On"
      tab, For the option "Log on as:", select This account and put in 
      the user name and password of this account, and restart the service.
      It should now be started as a user process. To make sure if its running
      as a user process, open process manager by pressing "ctrl-alt-delete"
      and look for processes "wrapper.exe" and "java.exe". The UserName 
      should be the user name of this account instead of SYSTEM. There may
      be other java processes running on the machine, which may end up 
      showing multiple java.exe on the process list. If this is the case, 
      then "wrapper.exe" is the only process that is representing the 
      MPJ Express daemon. 
     </li> 
     <li> 
      Delete all log files before the first execution
     </li>
     <li>
      Execute following on cygwin
     </li>
        <ul> 
          <li> <code>
          chmod a+w $MPJ_HOME/logs
               </code> 
          </li>
          <li> <code> 
            chmod a+x $MPJ_HOME/lib/*.dll 
               </code> 
          </li>
          <li> <code>
            chmod a+w $MPJ_HOME/logs/wrapper.log 
               </code> 
          </li>
            <ul>
              <li> 
                If wrapper.log is present
              </li>
            </ul>
        </ul>
    </ul>
</ul>

<br />
<a name="classloading"> </a>
<li>
   Mixing local loading and remote loading may end up in ClassNotFoundException
   for $MPJ_HOME/src/mpi/MPI.java class. This specific class is the one 
   shown in exception stack trace because this is the entry point to MPJE
   classes. This can happen in scenarios when you have MPJE application 
   in your working directory, CLASSPATH contains ".", and you are
   using remote loading. Under the hoods, the application is loaded 
   by the MPJE daemon using local loader (because working directory contains
   applications) and this application tries to load MPJE classes though a 
   URL. Because this application is loaded using the local loader (default), 
   it will not be able to load MPJE classes from a URL. To avoid this error,
   it is necessary not to have your applications in working directory when 
   using remote loader. If your programs reads some file, then it may be 
   a good idea to separate this file from your application classes, or copy 
   it to a tmp directory and specify this tmp directory as working directory
   using -wdir switch.
</li>
<!-- 
//in-progress stuff ...
$. Output being eaten-up by the runtime guy ... (????) 
$. Updating the docs ...checking the docs ..and stuff like that ...   
$. What happens if MPJ runtime is running an app and another one is requested.
   i. I put in a naive test ...the thing is ..the codebase can be different 
      isn't it ...then what happens ...
$. What is the count/numEls/type value of Status when MPI.PACK is 
   used as the datatype.
$. happy with group and communicator operations ... ???? ???? ????   
$. jetty output ...just hate jetty for outputting lines! 
-->
</ul>

</ol>
</body>
</html>

<!--
<? include($DOCUMENT_ROOT."/INCLUDES/layout_bottom.inc.php"); ?>
-->

